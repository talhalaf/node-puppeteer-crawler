const PDFObject = {
  "header": [
    {
      "Title": "General Information",
      "WrntyFieldName": "",
      "CustomField": false,
      "ApiName": "GeneralInformation",
      "FieldType": 13,
      "ColumnWidth": 2,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 2,
        "Line_Number": 0
      },
      "value": "splitter"
    },
    {
      "Title": "Account Name",
      "WrntyFieldName": "Account Name",
      "CustomField": false,
      "ApiName": "AccountName",
      "FieldType": 1,
      "ColumnWidth": 1,
      "Layout": {
        "X": 0,
        "Y": 1,
        "Width": 1,
        "Line_Number": 1
      },
      "value": "A Las Vegas Store 1"
    },
    {
      "Title": "ID",
      "WrntyFieldName": "ID",
      "CustomField": false,
      "ApiName": "WrntyID",
      "FieldType": 2,
      "ColumnWidth": 1,
      "Layout": {
        "X": 1,
        "Y": 1,
        "Width": 1,
        "Line_Number": 1
      },
      "value": 48659549
    },
    {
      "Title": "Account External ID",
      "WrntyFieldName": "Account External ID",
      "CustomField": false,
      "ApiName": "AccountExternalID",
      "FieldType": 1,
      "ColumnWidth": 1,
      "Layout": {
        "X": 0,
        "Y": 2,
        "Width": 1,
        "Line_Number": 2
      },
      "value": "3962766"
    },
    {
      "Title": "Action Time",
      "WrntyFieldName": "Action Time",
      "CustomField": false,
      "ApiName": "ActionDateTime",
      "FieldType": 6,
      "ColumnWidth": 1,
      "Layout": {
        "X": 1,
        "Y": 2,
        "Width": 1,
        "Line_Number": 2
      },
      "value": "2018-05-11T14:28:43Z"
    },
    {
      "Title": "Sales Rep Name",
      "WrntyFieldName": "Sales Rep Name",
      "CustomField": false,
      "ApiName": "AgentName",
      "FieldType": 1,
      "ColumnWidth": 1,
      "Layout": {
        "X": 1,
        "Y": 3,
        "Width": 1,
        "Line_Number": 3
      },
      "value": "Fashion Buyer"
    },
    {
      "Title": "Account Information",
      "WrntyFieldName": "",
      "CustomField": false,
      "ApiName": "AccountInformation",
      "FieldType": 13,
      "ColumnWidth": 2,
      "Layout": {
        "X": 0,
        "Y": 4,
        "Width": 2,
        "Line_Number": 4
      },
      "value": "splitter"
    },
    {
      "Title": "Branch",
      "WrntyFieldName": "Branch",
      "CustomField": false,
      "ApiName": "Branch",
      "FieldType": 16,
      "ColumnWidth": 1,
      "Layout": {
        "X": 1,
        "Y": 5,
        "Width": 1,
        "Line_Number": 5
      },
      "value": "A Las Vegas Store 1"
    },
    {
      "Title": "Bill to Name",
      "WrntyFieldName": "Bill to Name",
      "CustomField": false,
      "ApiName": "BillToName",
      "FieldType": 1,
      "ColumnWidth": 1,
      "Layout": {
        "X": 0,
        "Y": 6,
        "Width": 1,
        "Line_Number": 6
      },
      "value": ""
    },
    {
      "Title": "Ship to Name",
      "WrntyFieldName": "Ship to Name",
      "CustomField": false,
      "ApiName": "ShipToName",
      "FieldType": 1,
      "ColumnWidth": 1,
      "Layout": {
        "X": 1,
        "Y": 6,
        "Width": 1,
        "Line_Number": 6
      },
      "value": ""
    },
    {
      "Title": "Bill to Address",
      "WrntyFieldName": "Bill to Address",
      "CustomField": false,
      "ApiName": "BillToAddress",
      "FieldType": 14,
      "ColumnWidth": 1,
      "Layout": {
        "X": 0,
        "Y": 7,
        "Width": 1,
        "Line_Number": 7
      },
      "value": {
        "BillToStreet": "3355 South Las Vegas Boulevard",
        "BillToCity": "Las Vegas",
        "BillToZipCode": "89109",
        "BillToState": "USA"
      }
    },
    {
      "Title": "Ship to Address",
      "WrntyFieldName": "Ship to Address",
      "CustomField": false,
      "ApiName": "ShipToAddress",
      "FieldType": 14,
      "ColumnWidth": 1,
      "Layout": {
        "X": 1,
        "Y": 7,
        "Width": 1,
        "Line_Number": 7
      },
      "value": {
        "ShipToStreet": "3355 South Las Vegas Boulevard",
        "ShipToCity": "Las Vegas",
        "ShipToZipCode": "89109",
        "ShipToState": "USA"
      }
    },
    {
      "Title": "Bill to Phone",
      "WrntyFieldName": "Bill to Phone",
      "CustomField": false,
      "ApiName": "BillToPhone",
      "FieldType": 1,
      "ColumnWidth": 1,
      "Layout": {
        "X": 0,
        "Y": 8,
        "Width": 1,
        "Line_Number": 8
      },
      "value": "702-555-5555"
    },
    {
      "Title": "Ship to Phone",
      "WrntyFieldName": "Ship to Phone",
      "CustomField": false,
      "ApiName": "ShipToPhone",
      "FieldType": 1,
      "ColumnWidth": 1,
      "Layout": {
        "X": 1,
        "Y": 8,
        "Width": 1,
        "Line_Number": 8
      },
      "value": "702-555-5555"
    },
    {
      "Title": "Order Information",
      "WrntyFieldName": "",
      "CustomField": false,
      "ApiName": "OrderInformation",
      "FieldType": 13,
      "ColumnWidth": 2,
      "Layout": {
        "X": 0,
        "Y": 9,
        "Width": 2,
        "Line_Number": 9
      },
      "value": "splitter"
    },
    {
      "Title": "Order Remark",
      "WrntyFieldName": "Order Remark",
      "CustomField": false,
      "ApiName": "Remark",
      "FieldType": 3,
      "ColumnWidth": 2,
      "Layout": {
        "X": 0,
        "Y": 10,
        "Width": 2,
        "Line_Number": 10
      },
      "value": ""
    }
  ],
  "cart": [
    {
      "Title": "Image",
      "WrntyFieldName": "Image",
      "CustomField": false,
      "ApiName": "Image",
      "FieldType": 20,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "values": [
        {
          "value": "https://s3-us-west-2.amazonaws.com/pepperi-storage-production/WrntyImages/3704323/PortfolioItems/7/14818817_1_200x200.jpg",
          "InternalID": 455944835
        },
        {
          "value": "https://s3-us-west-2.amazonaws.com/pepperi-storage-production/WrntyImages/3704323/PortfolioItems/0/14818070_1_200x200.jpg",
          "InternalID": 455944836
        },
        {
          "value": "https://s3-us-west-2.amazonaws.com/pepperi-storage-production/WrntyImages/3704323/PortfolioItems/0/14818070_1_200x200.jpg",
          "InternalID": 455944837
        },
        {
          "value": "https://s3-us-west-2.amazonaws.com/pepperi-storage-production/WrntyImages/3704323/PortfolioItems/0/14818070_1_200x200.jpg",
          "InternalID": 455944838
        }
      ]
    },
    {
      "Title": "Item Main Category Code",
      "WrntyFieldName": "Item Main Category Code",
      "CustomField": false,
      "ApiName": "ItemMainCategoryCode",
      "FieldType": 1,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "values": [
        {
          "value": "MCR00100BLU44",
          "InternalID": 455944835
        },
        {
          "value": "HB1036",
          "InternalID": 455944836
        },
        {
          "value": "HB1036",
          "InternalID": 455944837
        },
        {
          "value": "HB1036",
          "InternalID": 455944838
        }
      ]
    },
    {
      "Title": "Item Main Category",
      "WrntyFieldName": "Item Main Category",
      "CustomField": false,
      "ApiName": "ItemMainCategory",
      "FieldType": 1,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "values": [
        {
          "value": "NewWave",
          "InternalID": 455944835
        },
        {
          "value": "HandBags",
          "InternalID": 455944836
        },
        {
          "value": "HandBags",
          "InternalID": 455944837
        },
        {
          "value": "HandBags",
          "InternalID": 455944838
        }
      ]
    },
    {
      "Title": "Item Description",
      "WrntyFieldName": "Item Description",
      "CustomField": false,
      "ApiName": "ItemName",
      "FieldType": 1,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "values": [
        {
          "value": "Shirt",
          "InternalID": 455944835
        },
        {
          "value": "Fashion",
          "InternalID": 455944836
        },
        {
          "value": "Fashion",
          "InternalID": 455944837
        },
        {
          "value": "Fashion",
          "InternalID": 455944838
        }
      ]
    },
    {
      "Title": "Item Price",
      "WrntyFieldName": "Item Price",
      "CustomField": false,
      "ApiName": "ItemPrice",
      "FieldType": 8,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "values": [
        {
          "value": 45,
          "InternalID": 455944835
        },
        {
          "value": 44,
          "InternalID": 455944836
        },
        {
          "value": 44,
          "InternalID": 455944837
        },
        {
          "value": 44,
          "InternalID": 455944838
        }
      ]
    },
    {
      "Title": "Unit Quantity",
      "WrntyFieldName": "Unit Quantity",
      "CustomField": false,
      "ApiName": "UnitsQuantity",
      "FieldType": 7,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "values": [
        {
          "value": 10,
          "InternalID": 455944835
        },
        {
          "value": 11,
          "InternalID": 455944836
        },
        {
          "value": 11,
          "InternalID": 455944837
        },
        {
          "value": 11,
          "InternalID": 455944838
        }
      ]
    },
    {
      "Title": "Unit Price After Discount",
      "WrntyFieldName": "Unit Price After Discount",
      "CustomField": false,
      "ApiName": "UnitPriceAfterDiscount",
      "FieldType": 8,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "values": [
        {
          "value": 45,
          "InternalID": 455944835
        },
        {
          "value": 0,
          "InternalID": 455944836
        },
        {
          "value": 44,
          "InternalID": 455944837
        },
        {
          "value": 44,
          "InternalID": 455944838
        }
      ]
    },
    {
      "Title": "Total Unit Price After Discount",
      "WrntyFieldName": "Total Unit Price After Discount",
      "CustomField": false,
      "ApiName": "TotalUnitsPriceAfterDiscount",
      "FieldType": 8,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "values": [
        {
          "value": 450,
          "InternalID": 455944835
        },
        {
          "value": 0,
          "InternalID": 455944836
        },
        {
          "value": 484,
          "InternalID": 455944837
        },
        {
          "value": 484,
          "InternalID": 455944838
        }
      ]
    }
  ],
  "footer": [
    {
      "Title": "Totals Box",
      "WrntyFieldName": "Totals Box",
      "CustomField": false,
      "ApiName": "TotalsBox",
      "FieldType": 23,
      "ColumnWidth": 10,
      "Layout": {
        "X": 0,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "value": {
        "SubTotal": 2386,
        "DiscountPercentage": 3,
        "GrandTotal": 1375.46
      }
    },
    {
      "Title": "Signature",
      "WrntyFieldName": "Signature",
      "CustomField": false,
      "ApiName": "Signature",
      "FieldType": 25,
      "ColumnWidth": 10,
      "Layout": {
        "X": 1,
        "Y": 0,
        "Width": 1,
        "Line_Number": 0
      },
      "value": "Signature"
    }
  ],
  "fieldsNotFound": [],
  "CurrencySymbol": "USD"
};


const FIRSTPLACE = 0;
const NEXTPLACE = 1;
const BLANKSPOT = 1;

// Creating a Layout Matrix (position of headers and values)
function makeLayoutMatrix(UIControls){
  var matrix = new Array(UIControls.length);
  for (var i = 0; i < matrix.length; i++){
    matrix[i] = new Array(2);
  }
  var maxLine = 0;
  for (var i = 0; i < UIControls.length; i++) {
    var field = UIControls[i];
    if (field.Layout.Line_Number > maxLine){
      maxLine = field.Layout.Line_Number;
    }
    matrix[field.Layout.Y][field.Layout.X] = field;
    if (field.Layout.X === 1 && matrix[field.Layout.Y][0]===undefined){
      matrix[field.Layout.Y][FIRSTPLACE] = BLANKSPOT;
    }
    if(field.Layout.Width===2)    //full row
    matrix[field.Layout.Y][NEXTPLACE] = BLANKSPOT;
  }
  matrix.splice(maxLine+1);
  return matrix;
}
function getFieldValue(field){
  if (field.ApiName === 'ShipToAddress' || field.ApiName === 'BillToAddress'){
    var pre ='';
    if (field.ApiName === 'ShipToAddress')
      pre='Ship';
    else {
      pre="Bill";
    }
    var res = ` 
    ${field.value[pre+'ToStreet']} <br/>
    ${field.value[pre+'ToCity']}<br/>
    ${field.value[pre+'ToZipCode']}<br/>
    ${field.value[pre+'ToState']}<br/>
    ${field.value[pre+'ToCountry']}`;
    return res;
  }
  else
    return field.value;
}
function createHeaderColumn(field){
  // console.log(field);
  if (!field){
    field = {Title:'',value:''};
  }
  var res = 
  `<div class="col">
    ${field.Title}
  </div>
  <div class="col">
    ${getFieldValue(field)}
  </div>
  `;
  return res;
}
function createLine(lineArray){
  var res ='\n<div class="row">';   //create new line
  var field,secondField;
  if (lineArray[FIRSTPLACE] !== BLANKSPOT)
    field = lineArray[FIRSTPLACE];
  if (lineArray[NEXTPLACE] !== BLANKSPOT)
    secondField = lineArray[NEXTPLACE];
  // console.log('field',field,'secondField',secondField);
  if (field && field.FieldType === 13){    //splitter
    res = res + 
      `<div class="col splitter">
        <strong>${field.Title}</strong> 
      </div>
    </div>`;
  } else {                        //field with value
    if (!field || field.ApiName === 'TotalsBox'){      //first place is BLANKSPOT -- create two empty columns

      res = res + 
      ` ${createHeaderColumn()}
        ${createHeaderColumn(secondField)}`;
    } else {
      res = res + 
      ` ${createHeaderColumn(field)}`;
      if (lineArray[NEXTPLACE] !== BLANKSPOT){
        secondField = lineArray[NEXTPLACE];
        res = res + 
        `${createHeaderColumn(secondField)}`;
      }
    }   
  }
  res = res + '\n</div>'; 
  return res;
}
function createCartHeader(){
  var res = `<thead>
  <tr>`;
  for(var i = 0 ; i < PDFObject.cart.length ; i++){
    res = res + 
    `<th class="cart-header">
    <div class="header-text">
      <h7>
       ${PDFObject.cart[i].Title}
      </h7>
    </div>
    </th>
    `
  }
res = res +`</tr>
</thead>`
return res;
}
function getCartFieldValue(cartField,i){
  var res = '';
  // console.log("cartField",cartField,"I",i);
  if (cartField.FieldType===20)   //IMAGE
    res = `<img style="max-height:150px; max-width:150px; height:auto; width:auto;" src="${cartField.values[i].value}">`;
  else {                           //Regular value
    if (typeof cartField.values[i].value === "number"){
      res = parseFloat(Math.round(cartField.values[i].value * 100) / 100).toFixed(2);
    }
    else
      res = cartField.values[i].value;
  }
  return res;
}
function createCartRows(orderby){             //TODO: Order BY
  var res = '';

  for (var i = 0 ; i < PDFObject.cart[0].values.length; i++){       //for every line in cart
    res = res + '<tr>';
    for (var j = 0 ; j <  PDFObject.cart.length ; j++){             //for every field in line
      res = res + 
      `
      <td class="cart-line"> 
      ${getCartFieldValue(PDFObject.cart[j],i)}
      </td class="cart-line">
      `;
    }
    res = res + '</tr>';
  }
  res = res + createFinalRowSums();                   // create row for UnitsQuantity and TotalUnitsPriceAfterDiscount
  return res;
}
var totalQuantities;
var TotalUnitsPriceAfterDiscount;
function createFinalRowSums(){
  var res = '<tr class="final-row">';
  var colspan = 0;
  totalQuantities = PDFObject.cart.find(field => field.ApiName === 'UnitsQuantity').values.reduce((a,b) => a + b.value,0);
  TotalUnitsPriceAfterDiscount= PDFObject.cart.find(field => field.ApiName === 'TotalUnitsPriceAfterDiscount').values.reduce((a,b) => a + b.value,0);
  for (var i = 0 ; i <  PDFObject.cart.length ; i++){             //for every field in line
    if (PDFObject.cart[i].ApiName === 'UnitsQuantity' || PDFObject.cart[i].ApiName === 'TotalUnitsPriceAfterDiscount'){
      break;
    }
    colspan++;
  }
  res = res + `<td colspan=${colspan}></td>`;
  for(var i = colspan ; i < PDFObject.cart.length ; i++){
    if (PDFObject.cart[i].ApiName === 'UnitsQuantity'){
      res = res + `<td> ${parseFloat(Math.round(totalQuantities * 100) / 100).toFixed(2)} </td>`;
    }
    else if (PDFObject.cart[i].ApiName === 'TotalUnitsPriceAfterDiscount') {
      res = res + `<td> ${parseFloat(Math.round(TotalUnitsPriceAfterDiscount * 100) / 100).toFixed(2)} </td>`;
    }
    else {
      res = res + `<td> </td>`;
    }
  }
  res = res + '</tr>';
  return res;
}
function footerTemplate(){
  var res = '';
  var matrix = makeLayoutMatrix(PDFObject.footer);
  for(var i = 0 ; i < matrix.length ; i ++){
     res = res + createLine(matrix[i]);
  }
  return res;
}
function totalBoxTemplate(){
  var res = '';
  var TotalsBox = PDFObject.footer.find(field => field.ApiName === 'TotalsBox');
  if (TotalsBox){
    res = res + 
    `
    <div class="row">
      <div class="col" style="text-align: right;">
          SubTotal 
      </div>
      <div class="col" style="text-align: left;">
          ${PDFObject.CurrencySymbol === 'USD' ? '$' : ''}${parseFloat(Math.round(TotalUnitsPriceAfterDiscount * 100) / 100).toFixed(2)}
      </div>
    </div>
    <div class="row">
    <div class="col" style="text-align: right;">
        Discount (${TotalsBox.value.DiscountPercentage}%)
    </div>
    <div class="col" style="text-align: left;">
          ${PDFObject.CurrencySymbol === 'USD' ? '$' : ''} ${parseFloat(Math.round((TotalUnitsPriceAfterDiscount * TotalsBox.value.DiscountPercentage / 100) * 100) / 100).toFixed(2)}
    </div>
    </div>
      <div class="row" style="background-color:lightgray;">
        <div class="col" style="text-align: right;">
          Totals
        </div>
        <div class="col" style="text-align: left;">
          <strong>${TotalsBox.value.GrandTotal}</strong>
        </div>
    </div>
    <br/>
    <br/>
    `
  }
  return res;
}
function cartTemplate(){
  var res = createCartHeader();
  res = res + createCartRows();
  return res;
}

function headerTemplate(){
    var matrix = makeLayoutMatrix(PDFObject.header);
    var template ='';
    // console.log(matrix);
    for (var i = 0; i < matrix.length; i++){
      template = template + createLine(matrix[i],i);
    }
    // console.log(template);
    return template;
 }
document.getElementById("header").innerHTML =`
${headerTemplate()}
<br/>
<br/>`;
document.getElementById("table-cart").innerHTML=`
${cartTemplate()}
`;
document.getElementById("total-box").innerHTML=`
<br/>
${totalBoxTemplate()}
`
document.getElementById("footer").innerHTML=`
${footerTemplate()}
`
// ${totalBoxTemplate()}
// ${footerTemplate()}
